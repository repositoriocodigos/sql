/*********************************************/
/**********  PROCESSO ESCRITORIOS    *********/
/*********************************************/
/**********  RB RC & RETIRADA ****************/
/*********************************************/
/*RB= REMESSA-BILLING RC= REMESSA-COMPLEMENTAR RT= REMESSA-RETIRADA*/

/* PARAMETRIZE OS ITENS ABAIXO */
					
%LET DAT_ARQUIVO = '31JAN2014'D;

/*%LET CAMINHO 	= '\\BRSLP1W8PFS03\GRUPOS\AFINIDADE\PLANEJAMENTO_CREDITO_COBRANCA\008_M.I.S\03_BOOK_ESCOBS\TXT\RB\R_EM20140117_1.TXT';*/

/*%LET CAMINHO 	= '\\BRSLP1W8PFS03\GRUPOS\AFINIDADE\PLANEJAMENTO_CREDITO_COBRANCA\008_M.I.S\03_BOOK_ESCOBS\TXT\RC\Q_EM20140123.TXT';*/ 

%LET CAMINHO 	= '\\BRSLP1W8PFS03\GRUPOS\AFINIDADE\PLANEJAMENTO_CREDITO_COBRANCA\008_M.I.S\03_BOOK_ESCOBS\TXT\RT\B_EM20140131.TXT';

%LET BASE 		= PADRAO; 

%LET ESCOB1 	= "EMPRESARIO            "; /* A1SOLUCOES ULTRACENTER EMPRESARIO */
%LET BASE_DESC 	= 'BAIXA           '; /* BAIXA 	REMESSA 	REMESSA COMP */
%LET ANOMES		= 201401;
DATA &BASE; /*IMPORTACAO DA ARQUIVO TXT*/	
    LENGTH
        C_DLETRA $ 1
	    C_CODI $ 20
	    FILLER $ 2
	    C_TIPO $ 2
	    C_NUMT $ 18
		C_FILIAL $ 5
		C_TOTPAR $ 2
		C_PARCI $ 2
		C_PARCF $ 2
		C_VENCIM $ 8
		C_VPAR $ 12
		C_VTPAR $ 12
		C_OPERESP $ 3
		C_OBSE $ 60
		C_ID_EMP $ 16
		C_DATRET $ 8
		C_DATEMI $ 8
		P_SITUAC $ 4
		FILLER2 $ 378
		C_CREDOR $ 5
		C_DT_DESATIV $ 8
		C_DT_SUSPENSAO $ 8
		C_NEGATIVADO $ 1
		C_DT_NEGATIVACAO $ 8
		C_CENTRO_CUSTO $ 50
		C_SOCIO1 $ 20
		C_PER_SOCIO1 $ 3
		C_SOCIO2 $ 20
		C_PER_SOCIO2 $ 3
		C_SOCIO3 $ 20
		C_PER_SOCIO3 $ 3
		C_RENDA $ 15
		C_CAP_SOCIAL $ 15
		C_DT_FUND $ 8
		C_CONTATO_1 $ 30
		C_FONE_1_1 $ 15
		C_FONE_2_1 $ 15
		C_FONE_3_1 $ 15
		C_CONTATO_2 $ 30
		C_FONE_1_2 $ 15
		C_FONE_2_2 $ 15
		C_FONE_3_2 $ 15
		C_CONTATO_3 $ 30
		C_FONE_1_3 $ 15
		C_FONE_2_3 $ 15
		C_FONE_3_3 $ 15
		C_CONTATO_1_1 $ 30
		C_FONE_NEXTEL_1 $ 15
		C_CONTATO_2_2 $ 30
		C_FONE_NEXTEL_2 $ 15
		C_CONTATO_3_3 $ 30
		C_FONE_NEXTEL_3 $ 15
		C_QTD_DIUL_VENC $ 5
		C_MOTIVO_BXA $ 5
		FILLER3 $ 2;
    FORMAT
		C_DLETRA CHAR1.
		C_CODI CHAR20.
		FILLER CHAR2.
		C_TIPO CHAR2.
		C_NUMT CHAR18.
		C_FILIAL CHAR5.
		C_TOTPAR CHAR2.
		C_PARCI CHAR2.
		C_PARCF CHAR2.
		C_VENCIM CHAR8.
		C_VPAR CHAR12.
		C_VTPAR CHAR12.
		C_OPERESP CHAR3.
		C_OBSE CHAR60.
		C_ID_EMP CHAR16.
		C_DATRET CHAR8.
		C_DATEMI CHAR8.
		P_SITUAC CHAR4.
		FILLER2 CHAR378.
		C_CREDOR CHAR5.
		C_DT_DESATIV CHAR8.
		C_DT_SUSPENSAO CHAR8.
		C_NEGATIVADO CHAR1.
		C_DT_NEGATIVACAO CHAR8.
		C_CENTRO_CUSTO CHAR50.
		C_SOCIO1 CHAR20.
		C_PER_SOCIO1 CHAR3.
		C_SOCIO2 CHAR20.
		C_PER_SOCIO2 CHAR3.
		C_SOCIO3 CHAR20.
		C_PER_SOCIO3 CHAR3.
		C_RENDA CHAR15.
		C_CAP_SOCIAL CHAR15.
		C_DT_FUND CHAR8.
		C_CONTATO_1 CHAR30.
		C_FONE_1_1 CHAR15.
		C_FONE_2_1 CHAR15.
		C_FONE_3_1 CHAR15.
		C_CONTATO_2 CHAR30.
		C_FONE_1_2 CHAR15.
		C_FONE_2_2 CHAR15.
		C_FONE_3_2 CHAR15.
		C_CONTATO_3 CHAR30.
		C_FONE_1_3 CHAR15.
		C_FONE_2_3 CHAR15.
		C_FONE_3_3 CHAR15.
		C_CONTATO_1_1 CHAR30.
		C_FONE_NEXTEL_1 CHAR15.
		C_CONTATO_2_2 CHAR30.
		C_FONE_NEXTEL_2 CHAR15.
		C_CONTATO_3_3 CHAR30.
		C_FONE_NEXTEL_3 CHAR15.
		C_QTD_DIUL_VENC CHAR5.
		C_MOTIVO_BXA CHAR5.
		FILLER3 CHAR2.;
    INFORMAT
        C_DLETRA $CHAR1.
		C_CODI $CHAR20.
		FILLER $CHAR2.
		C_TIPO $CHAR2.
		C_NUMT $CHAR18.
		C_FILIAL $CHAR5.
		C_TOTPAR $CHAR2.
		C_PARCI $CHAR2.
		C_PARCF $CHAR2.
		C_VENCIM $CHAR8.
		C_VPAR $CHAR12.
		C_VTPAR $CHAR12.
		C_OPERESP $CHAR3.
		C_OBSE $CHAR60.
		C_ID_EMP $CHAR16.
		C_DATRET $CHAR8.
		C_DATEMI $CHAR8.
		P_SITUAC $CHAR4.
		FILLER2 $CHAR378.
		C_CREDOR $CHAR5.
		C_DT_DESATIV $CHAR8.
		C_DT_SUSPENSAO $CHAR8.
		C_NEGATIVADO $CHAR1.
		C_DT_NEGATIVACAO $CHAR8.
		C_CENTRO_CUSTO $CHAR50.
		C_SOCIO1 $CHAR20.
		C_PER_SOCIO1 $CHAR3.
		C_SOCIO2 $CHAR20.
		C_PER_SOCIO2 $CHAR3.
		C_SOCIO3 $CHAR20.
		C_PER_SOCIO3 $CHAR3.
		C_RENDA $CHAR15.
		C_CAP_SOCIAL $CHAR15.
		C_DT_FUND $CHAR8.
		C_CONTATO_1 $CHAR30.
		C_FONE_1_1 $CHAR15.
		C_FONE_2_1 $CHAR15.
		C_FONE_3_1 $CHAR15.
		C_CONTATO_2 $CHAR30.
		C_FONE_1_2 $CHAR15.
		C_FONE_2_2 $CHAR15.
		C_FONE_3_2 $CHAR15.
		C_CONTATO_3 $CHAR30.
		C_FONE_1_3 $CHAR15.
		C_FONE_2_3 $CHAR15.
		C_FONE_3_3 $CHAR15.
		C_CONTATO_1_1 $CHAR30.
		C_FONE_NEXTEL_1 $CHAR15.
		C_CONTATO_2_2 $CHAR30.
		C_FONE_NEXTEL_2 $CHAR15.
		C_CONTATO_3_3 $CHAR30.
		C_FONE_NEXTEL_3 $CHAR15.
		C_QTD_DIUL_VENC $CHAR5.
		C_MOTIVO_BXA $CHAR5.
		FILLER3 $CHAR2. ;
        INFILE &CAMINHO
        LRECL=1122
        ENCODING="WLATIN1"
        TRUNCOVER;
    INPUT
		@1 C_DLETRA $CHAR1.
		@2 C_CODI $CHAR20.
		@22 FILLER $CHAR2.
		@24 C_TIPO $CHAR2.
		@26 C_NUMT $CHAR18.
		@44 C_FILIAL $CHAR5.
		@49 C_TOTPAR $CHAR2.
		@51 C_PARCI $CHAR2.
		@53 C_PARCF $CHAR2.
		@55 C_VENCIM $CHAR8.
		@63 C_VPAR $CHAR12.
		@75 C_VTPAR $CHAR12.
		@87 C_OPERESP $CHAR3.
		@90 C_OBSE $CHAR60.
		@150 C_ID_EMP $CHAR16.
		@166 C_DATRET $CHAR8.
		@174 C_DATEMI $CHAR8.
		@182 P_SITUAC $CHAR4.
		@186 FILLER2 $CHAR378.
		@564 C_CREDOR $CHAR5.
		@569 C_DT_DESATIV $CHAR8.
		@577 C_DT_SUSPENSAO $CHAR8.
		@585 C_NEGATIVADO $CHAR1.
		@586 C_DT_NEGATIVACAO $CHAR8.
		@594 C_CENTRO_CUSTO $CHAR50.
		@644 C_SOCIO1 $CHAR20.
		@664 C_PER_SOCIO1 $CHAR3.
		@667 C_SOCIO2 $CHAR20.
		@687 C_PER_SOCIO2 $CHAR3.
		@690 C_SOCIO3 $CHAR20.
		@710 C_PER_SOCIO3 $CHAR3.
		@713 C_RENDA $CHAR15.
		@728 C_CAP_SOCIAL $CHAR15.
		@743 C_DT_FUND $CHAR8.
		@751 C_CONTATO_1 $CHAR30.
		@781 C_FONE_1_1 $CHAR15.
		@796 C_FONE_2_1 $CHAR15.
		@811 C_FONE_3_1 $CHAR15.
		@826 C_CONTATO_2 $CHAR30.
		@856 C_FONE_1_2 $CHAR15.
		@871 C_FONE_2_2 $CHAR15.
		@886 C_FONE_3_2 $CHAR15.
		@901 C_CONTATO_3 $CHAR30.
		@931 C_FONE_1_3 $CHAR15.
		@946 C_FONE_2_3 $CHAR15.
		@961 C_FONE_3_3 $CHAR15.
		@976 C_CONTATO_1_1 $CHAR30.
		@1006 C_FONE_NEXTEL_1 $CHAR15.
		@1021 C_CONTATO_2_2 $CHAR30.
		@1051 C_FONE_NEXTEL_2 $CHAR15.
		@1066 C_CONTATO_3_3 $CHAR30.
		@1096 C_FONE_NEXTEL_3 $CHAR15.
		@1111 C_QTD_DIUL_VENC $CHAR5.
		@1116 C_MOTIVO_BXA $CHAR5.
		@1121 FILLER3 $CHAR2.;
RUN;
DATA BDESCOB;/*A1_BX EMP_BX ULT_BX A1_REM EMP_REM ULT_REM A1_QP EMP_QP ULT_QP*/	
     SET 
&BASE;		
     FORMAT MISDATE DATE10.;
     FORMAT DATA_ARQUIVO DATE10.;

ESCOB = &ESCOB1;
BASE = &BASE_DESC;

	 IF ESCOB = "A1SOLUCOES   " THEN P_COBR = "00035" ;
ELSE IF ESCOB = "ULTRACENTER" 	THEN P_COBR = "00032" ;
ELSE IF ESCOB = "EMPRESARIO" 	THEN P_COBR = "00031" ;
 
	 IF P_SITUAC = "ENV" THEN STATUS = "REMESSA    ";
ELSE IF P_SITUAC = "BXA" AND C_MOTIVO_BXA = "DP" THEN STATUS = "DECURSO";
ELSE IF P_SITUAC = "BXA" AND C_MOTIVO_BXA = "PG" THEN STATUS = "PAGAMENTO";
ELSE IF P_SITUAC = "BXA" AND C_MOTIVO_BXA = "OT" THEN STATUS = "OUTROS";
ELSE STATUS = "XXX";


ESPECIE = SUBSTR(C_NUMT,7,2);
TITULO = SUBSTR(C_NUMT,9,10) ;
ANO_VENC = SUBSTR(C_DATEMI,1,4);
BILLING = "BILLING_"||SUBSTR(C_VENCIM,7,2);
MISDATE = TODAY();

     IF LENGTH(C_CODI) = 14 THEN TIPO = "PJ";
     ELSE TIPO = "PF"; 
DATA_ARQUIVO = &DAT_ARQUIVO;
DATA_REMESSA = SUBSTR(C_VENCIM,7,2)||"/"||SUBSTR(C_VENCIM,5,2)||"/"||SUBSTR(C_VENCIM,1,4);
     WHERE C_DLETRA = 'C';
RUN;
DATA ESCOBS.BDESCOB_&ANOMES;/* EMPILHAMENTO */ 
     SET ESCOBS.BDESCOB_&ANOMES
		BDESCOB;
RUN;
PROC TABULATE /*REPORT COM O RESULTADO DAS IMPORTACOES*/
     DATA = 	ESCOBS.BDESCOB_&ANOMES				MISSING FORMAT = COMMAX15.	ORDER = FORMATTED;	
	 TITLE	CONTAGEM;																
     CLASS	BASE DATA_ARQUIVO ESCOB;																
     TABLE	DATA_ARQUIVO='' ALL,	ESCOB*BASE=''*N=''	ALL*N='';						
KEYLABEL ALL = 'TOTAL';
RUN;	
/*PROC SQL;
DELETE FROM ESCOBS.BDESCOB_201401
WHERE DATA_ARQUIVO = '17JAN2014'D
AND BASE  = 'BAIXA'
AND ESCOB = 'A1SOLUCOES';
RUN; */